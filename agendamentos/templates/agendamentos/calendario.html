{% extends 'agendamentos/base.html' %}
{% block container_class %}container-wide{% endblock %}

{% block title %}Calendário de Agendamentos{% endblock %}

{% block content %}
<h2>Calendário de Agendamentos</h2>

<div id='calendar'></div>
{% endblock %}


{% block extra_js %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ... (código de inicialização do FullCalendar, como antes) ...
    var calendar = new FullCalendar.Calendar(calendarEl, {
      // ... (suas opções existentes: initialView, locale, events, etc.) ...
      eventContent: function(info) { /* ... (como estava antes) ... */ },

      // --- REATIVE O eventClick COM ESTA NOVA LÓGICA ---
      eventClick: function(info) {
        info.jsEvent.preventDefault();

        const props = info.event.extendedProps;
        const modal = document.getElementById('eventoModal');

        // Preenche o modal com os dados do evento clicado
        document.getElementById('modalTitulo').innerText = info.event.title;
        document.getElementById('modalServico').innerText = props.servico_nome;
        document.getElementById('modalValor').innerText = props.servico_preco;
        document.getElementById('modalEndereco').innerText = props.endereco;
        document.getElementById('modalObservacoes').innerText = props.observacoes;

        // Exibe o modal
        modal.style.display = 'flex';
      }
    });

    calendar.render();

    // Lógica para fechar o modal
    const modal = document.getElementById('eventoModal');
    const closeBtn = document.querySelector('.modal-close-btn');
    closeBtn.onclick = function() {
      modal.style.display = 'none';
    }
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }
  });
</script>
{% endblock %}