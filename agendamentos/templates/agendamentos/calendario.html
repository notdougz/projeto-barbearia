{% extends 'agendamentos/base.html' %}
{% block container_class %}container-wide{% endblock %}

{% block title %}Calendário de Agendamentos{% endblock %}

{% block content %}
<h2>Calendário de Agendamentos</h2>
<div id='calendar'></div>
{% endblock %}

{% block extra_js %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'pt-br',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: '{% url "api_todos_agendamentos" %}',
      aspectRatio: 1.8,
      dayMaxEvents: 2,
      eventTimeFormat: { hour: '2-digit', minute: '2-digit', hour12: false },
      moreLinkContent: function(args) { return `Mostrar mais (+${args.num})`; },
      
      eventClick: function(info) {
        info.jsEvent.preventDefault();
        const props = info.event.extendedProps;
        const modal = document.getElementById('eventoModal');
        
        document.getElementById('modalTitulo').innerText = info.event.title;
        document.getElementById('modalServico').innerText = props.servico_nome;
        document.getElementById('modalValor').innerText = props.servico_preco;
        document.getElementById('modalEndereco').innerText = props.endereco;
        document.getElementById('modalObservacoes').innerText = props.observacoes;
        
        modal.style.display = 'flex';
      }
    });
    calendar.render();

    const modal = document.getElementById('eventoModal');
    const closeBtn = document.querySelector('.modal-close-btn');
    if(modal && closeBtn) {
        closeBtn.onclick = function() { modal.style.display = 'none'; }
        window.onclick = function(event) { if (event.target == modal) { modal.style.display = 'none'; } }
    }
  });
</script>
{% endblock %}