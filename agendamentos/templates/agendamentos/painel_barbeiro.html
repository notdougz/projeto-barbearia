{% extends 'agendamentos/base.html' %}

{% block title %}Dashboard - {{ data_selecionada|date:"d/m/Y" }}{% endblock %}

{% block content %}

<div class="date-selector">
    <form method="GET" action="{% url 'painel_barbeiro' %}" id="date-form">
        <label for="data">
            <span class="icon icon-calendar"></span>Selecionar outra data:
        </label>
        <input type="date" name="data" id="id_data" value="{{ data_selecionada|date:'Y-m-d' }}">
    </form>
</div>

<div class="dashboard-header mb-3">
    <h2>
        <span class="icon icon-calendar"></span>Agenda para {{ data_selecionada|date:"d/m/Y" }}
    </h2>
    <div class="dashboard-actions">
        <a href="{% url 'agendamentos_mensais' %}" class="btn btn-primary">
            <span class="icon icon-calendar"></span><span class="btn-text">Agendamentos Mensais</span>
        </a>
        <a href="{% url 'criar_cliente' %}" class="btn btn-success">
            <span class="icon icon-add"></span><span class="btn-text">Novo Cliente</span>
        </a>
    </div>
</div>

{% if agendamentos %}
    <!-- CARDS DE AGENDAMENTOS -->
    <div class="mobile-appointments">
        {% for agendamento in agendamentos %}
        <div class="appointment-card">
            <div class="appointment-header">
                <div class="appointment-main-info">
                    <div class="appointment-time">{{ agendamento.hora|time:"H:i" }}</div>
                    <div class="appointment-client-name">{{ agendamento.cliente.nome }}</div>
                </div>
                <div class="appointment-status 
                    {% if agendamento.status == 'confirmado' %}status-confirmado
                    {% elif agendamento.status == 'a_caminho' %}status-a-caminho
                    {% elif agendamento.status == 'concluido' %}status-concluido
                    {% elif agendamento.status == 'cancelado' %}status-cancelado
                    {% endif %}">
                    {% if agendamento.status == 'confirmado' %}PENDENTE
                    {% elif agendamento.status == 'a_caminho' %}√Ä CAMINHO
                    {% elif agendamento.status == 'concluido' %}CONCLU√çDO
                    {% elif agendamento.status == 'cancelado' %}CANCELADO
                    {% endif %}
                </div>
            </div>
            
            <div class="appointment-info">
                <div class="appointment-info-row">
                    <span class="appointment-info-label">
                        <span class="icon icon-phone"></span>Telefone:
                    </span>
                    <span class="appointment-info-value">
                        {% if agendamento.cliente.telefone %}
                            <a href="tel:{{ agendamento.cliente.telefone }}">{{ agendamento.cliente.telefone }}</a>
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                
                <div class="appointment-info-row">
                    <span class="appointment-info-label">
                        <span class="icon icon-scissors"></span>Servi√ßo:
                    </span>
                    <span class="appointment-info-value">{{ agendamento.servico.nome }}</span>
                </div>
                
                {% if agendamento.cliente.endereco %}
                <div class="appointment-info-row">
                    <span class="appointment-info-label">
                        <span class="icon icon-location"></span>Endere√ßo:
                    </span>
                    <span class="appointment-info-value">
                        <a href="https://www.google.com/maps/search/?api=1&query={{ agendamento.cliente.endereco }}" target="_blank">
                            {{ agendamento.cliente.endereco|truncatechars:40 }}
                        </a>
                    </span>
                </div>
                {% endif %}
            </div>
            
            <div class="appointment-actions">
                {% if agendamento.status == 'confirmado' %}
                    <form action="{% url 'on_the_way_agendamento' agendamento.id %}" method="post" style="display: inline; flex: 1;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-info">
                            <span class="icon icon-on-the-way"></span>√Ä caminho
                        </button>
                    </form>
                    <form action="{% url 'concluir_agendamento' agendamento.id %}" method="post" style="display: inline; flex: 1;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">
                            <span class="icon icon-barber"></span>Concluir
                        </button>
                    </form>
                {% elif agendamento.status == 'a_caminho' %}
                    <form action="{% url 'concluir_agendamento' agendamento.id %}" method="post" style="display: inline; flex: 1;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">
                            <span class="icon icon-barber"></span>Concluir
                        </button>
                    </form>
                {% endif %}
                <a href="{% url 'editar_agendamento' agendamento.id %}" class="btn btn-sm btn-secondary" style="flex: 1;">
                    <span class="icon icon-edit"></span>Editar
                </a>
                <a href="{% url 'deletar_agendamento' agendamento.id %}" class="btn btn-sm btn-danger" style="flex: 1;">
                    <span class="icon icon-delete"></span>Deletar
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="no-appointments" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üìÖ</div>
        <p>Nenhum agendamento para a data selecionada.</p>
    </div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // Script para submeter o formul√°rio automaticamente quando a data mudar
    document.getElementById('id_data').addEventListener('change', function() {
        document.getElementById('date-form').submit();
    });
</script>
{% endblock %}